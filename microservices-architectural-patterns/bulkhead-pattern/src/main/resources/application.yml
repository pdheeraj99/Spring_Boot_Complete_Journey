spring:
  application:
    name: bulkhead-pattern   # ğŸ·ï¸ App name shown in logs & Actuator

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ¯  Resilience4j BULKHEAD SETTINGS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
resilience4j:

  # 1ï¸âƒ£ THREAD-POOL bulkhead (heavy, CPU-bound work)
  thread-pool-bulkhead:     # different from spring thread pool. here the threads are completely in addition to current how many threads are available in tomcat server
    metrics:
      enabled: true          # ğŸ“Š Expose Micrometer/Actuator stats
    instances:
      reportService:         # ğŸ—‚ï¸  Instance name â† must match @Bulkhead
        max-thread-pool-size: 3    # ğŸš§ Max 3 threads total
        core-thread-pool-size: 2   # ğŸ› ï¸ 2 threads running by default
        queue-capacity: 10          # â³ 10 extra requests may wait
        keep-alive-duration: 20ms  # ğŸ’¤ Spare threads die after idle

  # 2ï¸âƒ£ SEMAPHORE bulkhead (I/O or network calls)
  bulkhead:                 # It uses spring thread pool only
    metrics:
      enabled: true          # ğŸ“Š Expose Micrometer/Actuator stats
    instances:
      apiService:            # ğŸ—‚ï¸ Matches @Bulkhead in ApiService
        max-concurrent-calls: 2   # ğŸš¦ Only 2 calls allowed at once
        max-wait-duration: 3s      # â²ï¸  Third call waits â‰¤3 s then fails

  # NEW RETRY SECTION
  retry:
    instances:
      invoiceServiceRetry: # ğŸ—‚ï¸ A custom name for our retry instance
        maxAttempts: 3 # ğŸ”„ Waiter will swipe the card a maximum of 3 times
        waitDuration: 2s # â³ He will wait 2 seconds between each swipe
        # ğŸ‘‡ This is a pro-level rule
        retryExceptions:
          - java.io.IOException # ğŸ’³ Only retry for temporary "Connection Errors"
        ignoreExceptions:
          - java.lang.IllegalArgumentException # ğŸš« Never retry if the card number is fake

  # NEW CIRCUIT BREAKER SECTION
  circuitbreaker:
    instances:
      invoiceServiceCB: # ğŸ—‚ï¸ A name for our Main Gate Guard
        failureRateThreshold: 50 # If 50% of calls fail, the guard locks the gate
        slidingWindowSize: 10 # The guard will check the last 10 attempts
        waitDurationInOpenState: 30s # The gate will be locked for 30 seconds
        permittedNumberOfCallsInHalfOpenState: 3 # After 30s, he'll let 3 people try

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ©º  SPRING-BOOT ACTUATOR (monitoring endpoints)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,bulkheads,circuitbreakers
        # ğŸ’¡ Tip: use "*" only in local dev; never in prod
  endpoint:
    health:
      show-details: always   # ğŸ” /actuator/health shows component info
    bulkheads:
      enabled: true          # âœ… Actually register /actuator/bulkheads

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ  EXTRA LOGGING (optional)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
logging:
  level:
    io.github.resilience4j.bulkhead: TRACE  # â† Change to TRACE
    root: INFO

